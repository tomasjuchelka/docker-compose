version: "3.5"

services:
 
  esphome:
    image: esphome/esphome:2022.4.0
    container_name: esphome
    volumes:
      - "/nfs/docker/esphome:/config"
    ports:
      - "6052:6052"
    labels:
      - "diun.enable=true"
      - "diun.watch_repo=true"
      - "diun.max_tags=5"
      - "diun.include_tags=^\\d{1,2}\\.\\d{1,2}\\.\\d{1,2}$$"
    restart: unless-stopped

  diun:
    image: crazymax/diun:4.21.0
    container_name: diun_rpi3
    command: serve
    volumes:
      - "/nfs/docker/diun/rpi3:/data"
      - "/var/run/docker.sock:/var/run/docker.sock"
    environment:
      - "TZ=Europe/Prague"
      - "LOG_LEVEL=info"
      - "LOG_JSON=false"
      - "DIUN_WATCH_WORKERS=20"
      - "DIUN_WATCH_SCHEDULE=0 */6 * * *"
      - "DIUN_WATCH_FIRSTCHECKNOTIF=true"
      - "DIUN_PROVIDERS_DOCKER=true"
      - "DIUN_NOTIF_MQTT_SCHEME=mqtt"
      - "DIUN_NOTIF_MQTT_HOST=192.168.11.123"
      - "DIUN_NOTIF_MQTT_PORT=1883"
      - "DIUN_NOTIF_MQTT_CLIENT=RPI3"
      - "DIUN_NOTIF_MQTT_TOPIC=diun/docker_version"
    restart: unless-stopped